<!DOCTYPE html>
<html>
<head>
    <title>Workout App OAuth Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 0 20px; }
        button { padding: 10px 20px; margin: 10px 0; }
        pre { background: #f4f4f4; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Workout App OAuth Test</h1>
    
    <button onclick="startAuth()">1. Start Authentication</button>
    <button onclick="listSheets()">2. List Sheets</button>
    <div>
        <h3>Selected Sheet Data:</h3>
        <input type="text" id="sheetId" placeholder="Enter Sheet ID">
        <button onclick="getWorkoutData()">3. Get Workout Data</button>
    </div>

    <h3>Response:</h3>
    <pre id="response">Results will appear here...</pre>

    <script>
        let userId = localStorage.getItem('userId');
        
        async function startAuth() {
            try {
                const response = await fetch('http://localhost:3000/api/auth/google');
                const data = await response.json();
                window.location.href = data.url;
            } catch (error) {
                document.getElementById('response').textContent = `Error: ${error.message}`;
            }
        }

        async function listSheets() {
            console.log(userId);
            if (!userId) {
                document.getElementById('response').textContent = 'Please authenticate first!';
                return;
            }

            try {
                const response = await fetch('http://localhost:3000/api/sheets/list', {
                    headers: {
                        'user-id': userId
                    }
                });
                const data = await response.json();
                document.getElementById('response').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('response').textContent = `Error: ${error.message}`;
            }
        }

        async function getWorkoutData() {
            if (!userId) {
                document.getElementById('response').textContent = 'Please authenticate first!';
                return;
            }

            const sheetId = document.getElementById('sheetId').value;
            if (!sheetId) {
                document.getElementById('response').textContent = 'Please enter a Sheet ID!';
                return;
            }

            try {
                const response = await fetch(`http://localhost:3000/api/workouts/${sheetId}`, {
                    headers: {
                        'user-id': userId
                    }
                });
                const data = await response.json();
                document.getElementById('response').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('response').textContent = `Error: ${error.message}`;
            }
        }

        // Check if we're returning from OAuth
        const urlParams = new URLSearchParams(window.location.search);
        const userIdFromUrl = urlParams.get('userId');
        if (userIdFromUrl) {
            localStorage.setItem('userId', userIdFromUrl);
            userId = userIdFromUrl;
            document.getElementById('response').textContent = 'Authentication successful! UserId stored.';
        }
    </script>
</body>
</html>